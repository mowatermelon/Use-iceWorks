const e=require("uuid"),{EventEmitter:s}=require("events"),t=require("./Session"),i=require("../../spc"),d={},n="session:data",r="session:exit",o="session:newline";class c extends s{constructor(){super()}new({uid:s=e.v4(),cwd:c,shell:l,shellArgs:u,env:p={}},a=(()=>{})){const w=new t({cwd:c,shell:l,shellArgs:u,env:p});return d[s]=w,i.emit(n,{uid:s,cwd:c,pid:w.pty.pid,data:`${l} ${u.join(" ")} \n\r`}),w.on("data",e=>{i.emit(n,{uid:s,pid:w.pty.pid,cwd:c,data:e})}),w.on("exit",(e,t)=>{i.emit(r,{uid:s,pid:w.pty.pid,cwd:c,code:e,signal:t}),i.emit(o,{cwd:c}),this.delete(s),a(e,t)}),w}delete(e){delete d[e]}destory(){return new Promise((e,s)=>{Object.keys(d).forEach(e=>{d[e].destroy()}),e()})}}module.exports=new c;