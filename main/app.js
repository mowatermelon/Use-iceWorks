const{ipcMain:e}=require("electron"),{globalShortcut:o}=require("electron"),r=require("./logger"),{isWin:t,isMac:s}=require("./shared"),i=require("./dau"),n=require("./services/sessions");s&&(process.env.PATH=["/usr/local/bin",process.env.PATH].join(":")),exports.registerApp=((o,s)=>{o.on("will-quit",()=>{console.log("will-quit")}).on("window-all-closed",()=>{console.log("window-all-closed"),t?n.manager.destory().then(()=>{o.quit()}).catch(()=>{o.quit()}):n.manager.destory().then(()=>{}).catch(()=>{})}).on("before-quit",()=>{r.report("app",{action:"before-quit"}),console.log("before-quit")}).on("activate",()=>{s.home.show(),s.home.focus()}),e.on("setTitle",(e,o)=>{s.home.setTitle(o)}),s.home.on("focus",({sender:e})=>{i.record(),e.webContents.send("focus")})}),exports.registerShortcut=((e,t)=>{const s="CommandOrControl+alt+P";o.register(s,()=>{t.home.show()})&&(r.info("shortcutKey register success",s),r.report("app",{action:"shortcut-key",shortcutKey:s})),e.on("will-quit",()=>{o.unregisterAll()})});