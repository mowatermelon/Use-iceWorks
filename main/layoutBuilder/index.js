const e=require("ejs"),s=require("path"),i=require("fs"),t=require("mkdirp"),o=require("uppercamelcase"),n=require("kebab-case"),r=require("../utils/codeFormat");function a(o,n,a){const d=i.readFileSync(o,"utf-8");let c;try{c=e.render(d,a);const i=s.extname(o);c=r(c,{parser:/\.jsx?/i.test(i)?"babylon":"scss"})}catch(e){throw console.log(e),e}return t.sync(s.dirname(n)),i.writeFileSync(n,c,"utf-8"),c}function d(e,s){i.writeFileSync(s,`${e.layoutName}\n---\n\u8fd9\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5e03\u5c40\uff0c\u62e5\u6709\u4ee5\u4e0b\u7279\u6027\n\n- \u4e3b\u9898: ${e.theme}\n- ${e.fixedWidth?"":"\u4e0d"}\u56fa\u5b9a\u5bbd\u5ea6\n- \u9876\u680f (Header)\n  - ${e.header.disabled?"\u4e0d":""}\u5c55\u793a\u9876\u680f\n  - ${e.header.displayNavs?"\u4e0d":""}\u5c55\u793a\u5bfc\u822a\n  - ${e.header.fixed?"\u4e0d":""}\u4f7f\u7528\u56fa\u5b9a\u5e03\u5c40\n- \u8fb9\u680f (Aside)\n  - ${e.aside.disabled?"\u4e0d":""}\u5c55\u793a\u9876\u680f\n  - ${e.aside.fixed?"\u4e0d":""}\u4f7f\u7528\u56fa\u5b9a\u5e03\u5c40\n  - ${e.aside.displayNavs?"\u4e0d":""}\u5c55\u793a\u5bfc\u822a\n  - ${e.aside.pushRow?"\u901a\u9876\u4fa7\u8fb9\u680f":"\u8fb9\u680f\u7f29\u8fdb"}\n- \u5e95\u680f (Footer)\n  - ${e.footer.disabled?"\u4e0d":""}\u5c55\u793a\u9876\u680f\n\n\n`,"utf-8")}module.exports=(e=>{let{destDir:r,layoutName:c,page:u,header:l,aside:h,footer:x}=e;const y=n(o(c));c=o(c);const j=s.join(r,"src/layouts",c);if(i.existsSync(j))throw new Error("\u5df2\u5b58\u5728\u540c\u540d\u7684 Layout\uff0c\u8bf7\u66f4\u6362\u540d\u79f0");t.sync(j);const m={layoutName:c,kebabLayoutName:y,theme:u.theme,fixedWidth:u.fixedWidth,header:l,aside:h,footer:x},p=[{sourceFile:"index.js",distnation:"index.js"},{sourceFile:"Header.jsx",distnation:"@/components/Header.jsx",overrides:!1},{sourceFile:"Logo.jsx",distnation:"@/components/Logo.jsx",overrides:!1},{sourceFile:"Footer.jsx",distnation:"@/components/Footer.jsx",overrides:!1},{sourceFile:"scss/base.scss",distnation:"scss/base.scss"},{sourceFile:"scss/dark.scss",distnation:"scss/dark.scss"},{sourceFile:"scss/light.scss",distnation:"scss/light.scss"}];h.pushRow?p.push({sourceFile:"AsideLayout.jsx",distnation:"Layout.jsx"}):p.push({sourceFile:"Layout.jsx",distnation:"Layout.jsx"});for(let e=0;e<p.length;e++){const t=p[e],o=t.distnation.replace(/^@/,s.join(r,"src")),n=/^@/.test(t.distnation)?o:s.join(j,t.distnation);i.existsSync(n)&&!t.overrides||a(s.join(__dirname,"templates",t.sourceFile),n,m)}d(m,s.join(j,"README.md"))});