const e=require("babylon"),r=require("fs"),i=require("babel-generator").default,t=require("prettier"),n=require("babel-types"),a=require("babel-traverse").default,o=require("../../config"),s="asideMenuConfig";function l({path:e,name:r,icon:i="home"}){return n.objectExpression([n.objectProperty(n.stringLiteral("name"),n.stringLiteral(r)),n.objectProperty(n.stringLiteral("path"),n.stringLiteral(e)),n.objectProperty(n.stringLiteral("icon"),n.stringLiteral(i))])}module.exports=async function({name:p,path:u,icon:c,menuConfigFilePath:m}){u=`/${u}`.replace(/^\/+/,"/");const b=r.readFileSync(m).toString(),g=e.parse(b,{sourceType:"module",plugins:["*"]});a(g,{VariableDeclarator({node:e}){if(n.isIdentifier(e.id,{name:s})&&n.isArrayExpression(e.init)){e.init.elements.some(e=>e.properties.some(e=>"path"==e.key.name&&e.value.value==u))||e.init.elements.push(l({name:p,path:u,icon:c}))}}}),r.writeFileSync(m,t.format(i(g).code,o.prettier))};