const e=require("fs"),r=require("mkdirp"),t=require("path"),i=require("request"),n=require("zlib"),a=require("tar");module.exports=function(p,s,o={}){return new Promise((u,c)=>{const m=[];i.get(p).on("error",c).pipe(n.Unzip()).pipe(a.Parse()).on("entry",i=>{if(/\.npmignore/.test(i.path))return;let n=i.path.replace(/^package\//,"");const a=o.sourceCodeDirectory||"";if(a){if(!n.startsWith(a))return;n=n.replace(a,"")}let p=t.join(s,n);const u=t.parse(p);u.base=u.base.replace(/^_/,"."),u.name=u.base,p=t.format(u),r.sync(t.dirname(p)),i.pipe(e.createWriteStream(p)),m.push(p)}).on("end",()=>{u(m)})})};