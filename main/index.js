const e=require("./logger"),r=require("./helper/checkEnv"),s=require("./services/settings"),o=require("./network"),i=require("./spc");global.log=e;const{app:a,dialog:t}=require("electron"),{appMenu:n,trayMenu:c}=require("./menu"),{registerApp:p,registerShortcut:l}=require("./app"),{createHomeWindow:u,createTouchBar:g}=require("./windowList"),d=require("./ipcService"),{isDev:h,registries:q}=require("./shared"),{register:b}=require("./autoUpdater"),m=require("./services"),{default:w,REACT_DEVELOPER_TOOLS:f}=require("electron-devtools-installer"),v=async()=>w(f);global.services=m;const y={};global.windows=y,m.createTouchBar=g,process.on("error",r=>{e.error(r.stack),e.report("app",{type:"error",error:JSON.stringify(r.message)}),t.showMessageBox({title:"\u7a0b\u5e8f\u5f02\u5e38",type:"error",message:r.message,callback:()=>{a.quit()}})}).on("unhandledRejection",(r,s)=>{e.error(`App Unhandled Rejection at:, ${s}, 'reason:', ${r}`),e.report("app",{type:"unhandled-rejection",reason:r,promise:s}),t.showMessageBox({title:"\u7a0b\u5e8f\u5f02\u5e38",type:"error",message:`App Unhandled Rejection at:, ${s}, 'reason:', ${r}`,callback:()=>{a.quit()}})}).on("uncaughtException",r=>{e.error(r.stack),e.report("app",{type:"uncaught-exception",error:JSON.stringify(r.message)}),t.showMessageBox({title:"\u7a0b\u5e8f\u5f02\u5e38",type:"error",message:`App uncaughtException$-${r}`,callback:()=>{a.quit()}})}),a.on("ready",async()=>{h&&await v(),e.info("process.version:",process.version),e.info("process.platform:",process.platform),e.info("process.arch:",process.arch),e.info("process.versions.modules:",process.versions.modules),e.report("app",{action:"launch",version:a.getVersion(),platform:process.platform,arch:process.arch}),s.init();const t=u(a);y.home=t,a.windows=y,global.windows=y,i.bindWindow(t),n(a,y),p(a,y),l(a,y),h||b(a,y),d.init(),r(),s.get("forceNotAlibaba")?s.set("isAlibaba",!1):o.isAlibaba().then(e=>{e&&s.set("isAlibaba",e)})});